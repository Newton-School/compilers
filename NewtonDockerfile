FROM judge0/compilers:1.4.0


# Check for latest version here: https://www.python.org/downloads
ENV PYTHON_FOR_ML_VERSIONS \
      3.10.4

RUN set -xe && \
    for VERSION in $PYTHON_FOR_ML_VERSIONS; do \
      curl -fSsL "https://www.python.org/ftp/python/$VERSION/Python-$VERSION.tar.xz" -o /tmp/python-$VERSION.tar.xz && \
      mkdir /tmp/python-$VERSION && \
      tar -xf /tmp/python-$VERSION.tar.xz -C /tmp/python-$VERSION --strip-components=1 && \
      rm /tmp/python-$VERSION.tar.xz && \
      cd /tmp/python-$VERSION && \
      ./configure \
        --prefix=/usr/local/python-$VERSION && \
      make -j$(nproc) && \
      make -j$(nproc) install && \
      rm -rf /tmp/*; \
    done

# Python for ML
RUN apt-get update && \
    /usr/local/python-3.10.4/bin/pip3 install \
        mlxtend \
        numpy \
        pandas \
        scikit-learn \
        pytest \
        scipy \
        matplotlib \
        gspread \
        bs4 \
        seaborn \
        xgboost \
        Pillow \
        urllib3 \
        statistics \
        requests && \
    rm -rf /var/lib/apt/lists/*

ENV LATEST_NODE_VERSIONS \
      18.15.0
RUN set -xe && \
    for VERSION in $LATEST_NODE_VERSIONS; do \
      curl -fSsL "https://nodejs.org/dist/v$VERSION/node-v$VERSION.tar.gz" -o /tmp/node-$VERSION.tar.gz && \
      mkdir /tmp/node-$VERSION && \
      tar -xf /tmp/node-$VERSION.tar.gz -C /tmp/node-$VERSION --strip-components=1 && \
      rm /tmp/node-$VERSION.tar.gz && \
      cd /tmp/node-$VERSION && \
      ./configure \
        --prefix=/usr/local/node-$VERSION && \
      make -j$(nproc) && \
      make -j$(nproc) install && \
      rm -rf /tmp/*; \
    done

RUN echo "deb http://archive.ubuntu.com/ubuntu bionic universe" > /etc/apt/sources.list.d/universe.list \
    && apt-get update

RUN add-apt-repository ppa:sqlite/sqlite-regex

RUN set -xe && \
    apt-get update && \
    apt-get install -y --no-install-recommends sqlite3 sqlite3-pcre && \
    rm -rf /var/lib/apt/lists/*
